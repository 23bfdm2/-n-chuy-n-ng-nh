@model IEnumerable<JobPortal.Data.ViewModel.ListCVsViewModel>
@using Microsoft.AspNetCore.Identity
@using Microsoft.AspNetCore.Http
@inject SignInManager<AppUser> signInManager
@inject UserManager<AppUser> userManager

@{
    var user = await userManager.GetUserAsync(User);
}

<!-- Css Styles -->
<link rel="stylesheet" href="~/assets/css/style.css" type="text/css">

<!-- Feedback -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                @*<form asp-action="Feeback" asp-route-id="@Model.Id" enctype="multipart/form-data" method="post">
                    <div class="form-group">
                        <label asp-for="UrlImage" class="control-label"></label>  <span class="text-danger">*</span>
                        <input type="file" asp-for="UrlImage" class="form-control" accept="image/*" id="imgInp" />
                        <span asp-validation-for="UrlImage" class="text-danger"></span>
                        <img id="blah" src="#" alt="your image" style="width: 200px;" />
                    </div>
                    <div class="form-group">
                        <input type="submit" value="Cập nhật" class="btn btn-primary" />
                    </div>
                </form>*@
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Start banner Area -->
<section class="banner-area relative" id="home">
    <div class="overlay overlay-bg"></div>
    <div class="container">
        <div class="row d-flex align-items-center justify-content-center">
            <div class="about-content col-lg-12">
                <h1 class="text-white">
                    <span>Interview job</span>
                </h1>
                <p class="text-white link-nav"><a href="/">Home </a>  <span class="lnr lnr-arrow-right"></span>  <a href="/"> Home page</a></p>
            </div>
        </div>
    </div>
</section>
<!-- End banner Area -->
<!-- Start contact-page Area -->
<section class="shoping-cart spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="card">
                    <div class="card-body">
                        <div class="featured__controls">
                            <ul>
                                <li class="active" data-filter="*">All</li>
                                <li data-filter=".wait">Waiting</li>
                                <li data-filter=".cancel">Canceled</li>
                                <li data-filter=".accept">Accepted</li>
                                <li data-filter=".deny">Denied</li>
                            </ul>
                        </div>
                        <div class="featured__filter">
                            @foreach (var CV in Model)
                            {
                                <div class="shoping__cart__table mix @if(CV.CVStatus == 0) {<text>deny</text>}
                                                                     @if(CV.CVStatus == 1) {<text>wait</text>}
                                                                     @if(CV.CVStatus == -1) {<text>cancel</text>}
                                                                     @if(CV.CVStatus == 2) {<text>accept</text>}">
                                    <section class="d-flex mb-3" style="justify-content: space-between;">
                                        <p>
                                            <span>CV: <b>@CV.JobName</b></span> | Apply date: @CV.ApplyDate.ToString("dd/MM/yyyy") |
                                            @{
                                                switch (CV.CVStatus)
                                                {
                                                    case 0: <span class="text-danger"><b>Denied</b></span>
                                                        break;
                                                    case 1: <span class="text-success"><b>Waiting</b></span>
                                                        break;
                                                    case -1:
                                                        <span class="text-success"><b>Canceled</b></span>
                                                        break;
                                                    case 2: <span class="text-success"><b>Accepted</b></span>
                                                        break;
                                                    default: <span class="text-success"></span>
                                                        break;
                                                }
                                            }
                                        </p>
                                        <div>
                                            @if (CV.CVStatus == 0)
                                            {
                                                <button type="button" onclick="onDelete('@CV.CVId')" class="btn btn-danger">Delete CV</button>
                                            }
                                            @if (CV.CVStatus == 1)
                                            {
                                                <button type="button" onclick="onCancel('@CV.CVId')" class="btn btn-danger">Cancel CV</button>
                                            }
                                            @if (CV.CVStatus == 2)
                                            {
                                                <a href="/apply/@user.Id/@CV.CVId/feedback" class="btn btn-primary">Feedback CV</a>
                                            }
                                            @if (CV.CVStatus == -1)
                                            {
                                                <button type="button" onclick="onContinue('@CV.CVId')" class="btn btn-primary">Continue CV</button>
                                            }
                                        </div>
                                    </section>
                                    <table>
                                        <tbody id="items">
                                            <tr class="targetfields">
                                                <td class="shoping__cart__item">
                                                    <img src="https://localhost:7211/images/employers/@CV.EmployerLogo" alt="@CV.JobName" style="width: 100px;">
                                                    <a href="">
                                                        <h5>
                                                            @CV.Certificate
                                                        </h5>
                                                        <h5>
                                                            @CV.CVPhone
                                                        </h5>
                                                        <h5>
                                                            @CV.CVEmail
                                                        </h5>
                                                    </a>
                                                    <br />
                                                </td>
                                                <td class="shoping__cart__price" style="width: 200px">
                                                    @CV.Major <i class="pl-3" style="font-weight: 400"></i>
                                                </td>
                                                <td class="shoping__cart__total__" id="total_item.CartId">
                                                    @CV.GPA
                                                </td>
                                            </tr>
                                        </tbody>
                                        @*<tfoot>
                                            <tr>
                                                <th></th>
                                                <th>Total</th>
                                                <th>
                                                    <span style="font-size: 18px; color: #dd2222; float: right;" id="total__">0</span>
                                                </th>
                                            </tr>
                                        </tfoot>*@
                                    </table>
                                </div>
                                @*<script type="text/javascript">
                                    $(document).ready(function () {
                                    total_calculate(@detail.);
                                    });
                                    function total_calculate(id) {
                                    var total = 0;
                                    //loop through subtotal
                                    $(".targetfields .shoping__cart__total__" + id).each(function () {
                                    //chck if not empty
                                    var value = $(this).text() != "" ? parseFloat($(this).text()) : 0;
                                    total += value; //add that value
                                    })
                                    //assign to total span
                                    $("#total__" + id).text(total.toFixed(0))
                                    }
                                </script>*@
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- End contact-page Area -->

<style>
    .shoping__cart__table {
        border: 1px solid #e7e1e1;
        margin-bottom: 20px;
        display: block;
        border-radius: 4px;
        padding: 20px 30px;
        box-shadow: 6px 6px 5px #cccccc1c;
    }
    .shoping__cart__table table tfoot tr th {
        padding-top: 15px;
    }
    .shoping__cart__table table tbody tr td {
        padding-top: 10px;
        padding-bottom: 10px;
    }
</style>

<script>
    function onDelete(id) {
        Swal.fire({
            title: 'Delete this CV?',
            text: "Are you sure to delete the CV?",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Delete'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/apply/@user.Id/' + id + '/delete';
                Swal.fire(
                    'Delete!',
                    '',
                    'success'
                )
            }
        });
    }

    function onCancel(id) {
        Swal.fire({
            title: 'Cancel this CV?',
            text: "Are you sure to cancel CV?",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Cancel'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/apply/@user.Id/' + id + '/update/' + -1;
                Swal.fire(
                    'Cancel!',
                    '',
                    'success'
                )
            }
        });
    }

    function onContinue(id) {
        Swal.fire({
            title: 'Continue this CV?',
            text: "Are you sure to continue CV?",
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Continue'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/apply/@user.Id/' + id + '/update/' + 1;
                Swal.fire(
                    'Continue!',
                    '',
                    'success'
                )
            }
        });
    }
</script>